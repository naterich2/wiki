---
title: Pulsatile Flow
description: 
published: true
date: 2020-05-31T20:42:03.324Z
tags: 
---



# Steady, Osillatory, and Pulsatile Flow in a Rigid Tube

 #### By Nathan Richman

 #### Abstract
 Pulsatile flow is a form of fluid flow seen in arteries due to the pressures generated by the heart.  In this report I will investigate the fluid mechanics of a simplified model of pulsatile flow generated by the heart.  I will first give a description of physiological pulsatile flow, including geometries and physical properties.  Then I will discuss simplifying assumptions that allows for a basic model to be solved.  I will discuss results for this simplified model and conclude with how the model could be extended to be more physiologically relevant.
 #### Introduction
  Physiological pulsatile flow can be broken down into steady and oscillatory components.  Steady means constant in time, while oscillatory means a zero-mean (time average is zero) periodic flow driven by a periodic pressure gradient.  In the body, this pulsatile flow is generated by the periodic contractions of the heart generating a pressure gradient that propagates through arteries and into capillaries in tissue.

 Arteries can be approximated by tubes of various sizes.  Pulmonary arteries can vary from ~.3cm to 1.5cm in diameter [1].  Arteries are surrounded by elastin, a protein which gives the artery elastic properties and stiffens with age [2].  While arteries are elastic, the model for arterial flow is much simpler assuming the artery is a rigid tube.  Additionally, arteries can't necessarily be represented as tubes due to the many bifurcations and changes in shape [3]. Thus fluid flow in arteries is mostly determined with a combination of flow data from ultrasound or MRI, and computational analysis.

 Additionally, blood is a non-newtonian fluid that is best represented by the Casson model: $ \sqrt{\tau} = \sqrt{\mu} \sqrt{\gamma} + \sqrt{\tau_0}$ which relates shear stress, $\tau$ to shear rate $\gamma$.  This model describes blood as a shear-thinning (meaning it becomes less viscous at high shear rates) fluid that takes a certain shear stress $\tau_0$ to initially deform. However, for this analysis, I will assume the fluid is newtonian, ( $\tau_{xy} = 2 \mu \frac{1}{2}\left(\gamma_{xy} + \gamma{yx}\right)$ ) with a constant viscosity of 4 cP, and constant density of 1.06 $g/cm^3$

 #### Methods

 ##### Models
    ![](figures/Fluid_flow.png)
    
 **Figure 1:** Fluid flow in a tube, velocity in the z-direction is a function of $r$ and $t$, driven by the pressure gradient between $p_1(t)$ and $p_2(t)$

 ###### Steady
 For steady flow, we can assume velocity is only in the z-direction and only a function of radius, and pressure is only a function of z.  Similarly we can assume the radial and angular velocity are both 0, and that gravity in the z-direction is 0.  With these assumptions, the z-component of Navier-Stokes equations reduces to the following: 
 $$ 0 = -     \frac{d p}{dz} + \mu \left( \frac{1}{r}     \frac{d }{d r} \left(r     \frac{d v_z}{d r}\right)\right)$$
Solving this with the boundary conditions that the shear has to be finite in the middle of the tube, and the velocity at the surface of the tube is zero, we get the following velocity profile: 
$$v_z = \frac{a^2}{4 \mu}     \left( -\frac{d p}{dz}\right) \left( 1 - \left(\frac{r}{a}\right)^2\right)$$
We can then integrate over the cross-sectional area to get the volumetric flowrate: 
$$Q = \frac{\pi a^4}{8 \mu} \left(-\frac{d p}{d z}\right)$$ 
and find the shear stress from the derivative of the velocity profile: 
$$\tau_{rz} = -\frac{a}{2} \left(-\frac{d p}{d z}\right)$$
 A detailed solution of these equations can be found in Appendix II.
 ###### Oscillatory
 For oscillatory flow, we can assume that velocity is only in the z-direction, and a function of radius and time only.  Additionally, we can assume that radial and angular velocity are both 0, and that gravity in the z-direction is 0.  Under these conditions, the z-component of the Navier-Stokes equations simplify to the following: 
 $$\rho \frac{\partial v_z}{\partial t}  = -     \frac{\partial p}{\partial z} + \mu \left[    \frac{1}{r}\frac{\partial}{\partial r}\left(r     \frac{\partial v_z}{\partial r}\right)\right]$$

 By assuming a pressure form of $\frac{\partial p}{\partial z} = -p_0 e^{i n \omega t}$ and assuming that velocity follows a similar form (v_z(r,t) = V_s(r)\left(-p_0 e^{i n \omega t}\right)), we can perform a separation of variables as well as dimensional analysis to end up with the Bessel differential equation: 
 $$0 = \zeta^2 \frac{d^2 V(\zeta)}{d \zeta^2} + \zeta\frac{d V(\zeta)}{d \zeta} +  (\zeta^2 - \alpha^2) V(\zeta)  \textrm{, Where $\alpha = 0$}$$

 This can be solved with the boundary conditions that the flow be finite at the center (r = 0) and that it be zero at the wall (r = a): 
 $$v_z^n(\zeta,t) = \frac{i p_o a^2}{ \mu \Omega_n^2 } \left( 1 - \frac{J_0(\zeta)}{J_0(\Lambda_n)}\right) e^{i n \omega t}$$

where $i$ is the imaginary unit, $\Omega_n$ is the Womersley number, defined as $\Omega_n = a \sqrt{\frac{\rho n \omega}{\mu}}$, $\Lambda_n = \left(\frac{i - 1}{\sqrt{2}}\right) \Omega_n$, $\zeta = \Lambda_n\frac{r}{a}$, $J_0$ is the zero-order Bessel function of the first kind, and $n$ is the harmonic.  We can then integrate this again over the cross-sectional area to get the volumetric flow rate: 
$$ Q = \frac{\pi p_o a^4}{\mu \Omega_n^2} \left(1 - \frac{2 J_1(\Lambda_n)}{\Lambda_n J_0(\Lambda_n)}\right)e^{i n \omega t}$$

 And we can also use the derivative of the velocity profile to again get the shear stress:  
 $$ \tau_rz = -\frac{p_o a}{\Lambda_n}\left(\frac{J_1(\Lambda_n)}{J_0(\Lambda_n)} \right) e^{i n \omega t}$$

Detailed solutions of these equations are also in Appendix II

 ###### Pulsatile
 Pulsatile is then the linear combination of the steady and oscillatory profiles, giving the following velocity: 
 $$ v_z(\psi,t) = \frac{a^2}{4 \mu}     \left( C\right) \left( 1 - \psi^2\right) + \Re \left(D \sum_{n=1}^N \frac{i  C_n a^2}{ \mu \Omega_n^2 } \left( 1 - \frac{J_0(\Lambda_n \psi)}{J_0(\Lambda_n)}\right) e^{i (n \omega t - \Phi_n)}\right)$$
 where $\psi = \frac{r}{a}$ when driven with a pressure wave:

$$\frac{d p}{d z} = -C - D \sum_{n=1}^N C_n \cos(\frac{2 n \pi t}{T}+ \Phi_n)$$

 The volumetric flow rate can then be calculated similarly to above: 
 $$ Q = \frac{\pi C a^4}{8 \mu} + \Re \left(D \sum_{n=1}^N \frac{\pi  C_n a^4}{\mu \Omega_n^2}\left(1 - \frac{2 J_1(\Lambda_n)}{\Lambda_n J_0(\Lambda_n)}\right)e^{i(n \omega t - \Phi_n)} \right)$$

 And similarly, the wall shear stress: 
 $$ \tau_{rz} =C\frac{a}{2} +  \Re \left(D \sum_{n=1}^N \frac{ C_n a}{\Lambda_n} \frac{J_1(\Lambda_n)}{J_0(\Lambda_n)}e^{i(n \omega t - \Phi_n)}\right)$$

 ##### Simulation
 The simulation was done using python and the packages scipy, numpy, and matplotlib.  The main goal of the simulation was to visualize the flow in real time, as well as determine the relative effects of inertial and viscous effects in pulsatile flow which show up in the Reynolds number and Womersley number.

 #### Results

 ##### Steady Flow:
```python
np.warnings.filterwarnings('ignore')
T = .8
omega = 2*np.pi/T #1.25 hertz
plt.style.use('ggplot')
```
 We can first set our constants, namely $\rho = 1.06\ g/cm^3$, $\mu = 4 \ cP$.  Then we can set out diameter, $a = .65 \ cm$, and pressure gradient $- \frac{d p}{d z} = 46 \ \textrm{dynes/cm}^3$ and plot the Flow rate,
```python
fig,ax = plt.subplots(3,2,figsize=(15,15))
fig.suptitle('Steady Flow', fontsize=20)
rho = 1.06 #1060 kg/m^2 == 1.06g/cm^3
mu = .04
a = .65 #.65 cm
dp_dz = 46
umax = flow_steady(a,mu,rho,dp_dz,ax[:,0],r'$-\frac{d p}{d z} = 46 \ dynes/cm^3$, $R = 0.65 \ cm$')

a = .30 #cm
dp_dz = 100
umax2 = flow_steady(a,mu,rho,dp_dz,ax[:,1],r'$-\frac{d p}{d z} = 100 \ dynes/cm^3$, $R = 0.3 \ cm$')
```
 **Figure 1:** Steady flow velocity, shear, and volumetric flow rate for a pressure gradient of 46 $dyne/cm^3$ and radius 0.65 $cm$ (left). Pressure gradient of 100 $dyne/cm^2$ and a radius of 0.3  $cm$ (right).

**Table 1:** Table of Reynolds numbers for the two conditions shown in Figure 1.  The first condition has a much larger Reynolds number since the radius of the pipe is larger allowing a faster maximum velocity.
| Pressure Drop ($dyne/cm^3$)  | Radius (cm)  | $v_{max}$ cm/s |  Re |
|---|---|---|---|
|  46 |  0.65 | 121.42  | 4182.85  |
|100 |  0.3 | 56.23 | 894.002 |



 Steady flow here is independent of time, but still dependent on radius. Wall shear stress, pressure, and volumetric flow rate are also independent of time.  Volumetric flow rate for the larger radius tube is much larger than the volumetric flow rate for the smaller radius tube, whereas wall shear stress is fairly similar for both conditions.

 ##### Oscillatory Flow:
```python
T = .8
omega = 2*np.pi/T #1.25 hertz
a = .65
c_n_o_1 = [46]
phi_n_o_1 = [0]
omegas_o_1 = np.array([np.sqrt((n*rho*omega)/mu)*a for n in range(1,len(c_n_o_1)+1)])
lambdas_o_1 = ((1j - 1)/np.sqrt(2))*omegas_o_1
waves = (c_n_o_1,phi_n_o_1,omegas_o_1,lambdas_o_1)
flow(a,omega,mu,rho,waves,dp_dz,mode='oscillatory',title=r'Oscillatory flow for $- \frac{d P}{d z} = 46 \cos( \omega t) \ dynes/cm^3$ and $R = 0.65 \ cm$')
```
 **Figure 2:** Oscillatory velocity profiles, volumetric flow rate, and wall shear stress vs. time for $\omega = \frac{2 \pi}{.8} = 7.854$, $R = 0.65 \ cm$ and $- \frac{d P}{d z} = 46 \cos( \omega) \ dynes/cm^3$ .  The larger radius leads to a higher Womersley number of 9.377 making this profile more blunted (Table 2).
#+fig=False, echo = False
```python
a = .3
c_n_o_2 =  [100]
phi_n_o_2 = [0]
omegas_o_2 = np.array([np.sqrt((n*rho*omega)/mu)*a for n in range(1,len(c_n_o_2)+1)])
lambdas_o_2 = ((1j - 1)/np.sqrt(2))*omegas_o_2
waves = (c_n_o_2,phi_n_o_2,omegas_o_2,lambdas_o_2)
flow(a,omega,mu,rho,waves,dp_dz,mode='oscillatory',title=r'Oscillatory flow for $- \frac{d P}{d z} = 100 \cos( \omega t) \ dynes/cm^3$ and $R = \ 0.3 cm$')
```
 **Figure 3:** Oscillatory velocity profiles, volumetric flow rate, and wall shear stress vs. time for $\omega = \frac{2 \pi}{.8} = 7.854$, $R = 0.3 \ cm$ and $- \frac{d P}{d z} = 100 \cos( \omega) \ dynes/cm^3$ .  The smaller radius leads to a lower Womersley number of 4.328 making this profile less blunted (Table 2).

 **Table 2:** Womersley number for two oscillatory conditions.  Since the frequency for both conditions is the same, as well as the density and viscosity, the only value that changes and thus affects the Womersley number ($a \sqrt{\frac{\rho \omega}{\mu}}$) is the radius a.
 |  $\omega \ (rad/s)$  | Radius ($cm$)  | Womersley |
|---|---|---|
|  7.854 |  0.65 | 9.377  |
|7.854 |  0.3 | 4.328 | 


 In these two conditions of oscillatory flow, the profiles look different mostly due the difference in the radius of the tubes affecting the Womersley number of each flow.  The first condition has the highest amplitude flow rate due to the larger size of the tube. The wall shear stresses are similar orders of magnitude, but the smaller tube has larger wall shear stress.

 ##### Pulsatile Flow:

 Now we visualize pulsatile flow based on a heart beat with the followig pressure gradient:
 $$\frac{d P}{d z} = -C - D \displaystyle\sum_{n=1}^{10} C_n \cos \left( n \omega t +  \Phi_n \right)$$
 Where $C_n$ and $\Phi_n$ are given by the following:

 **Table 3:** Coefficients and shifts for the first 10 harmonics of a typical heartbeat.


| $n$  | $C_n$ | $\Phi_n$ (degrees)| 
|---|---|---|
 | 1  | 7.58  | -174 |
 | 2  | 5.41  | 89 |
 | 3  | 1.52  | -22 |
 | 4  | 0.52  | -34 |
 | 5  | 0.83  | -127 |
 | 6  | 0.69  | 135 |
 | 7  | 0.26  | 152 |
 | 8  | 0.54  | 44 |
 | 9  | 0.27 | -72 |
 | 10 | 0.10  | 11 |


  We can visualize the first set of results with $R = .65 \ cm$, $C = 50 \ dynes/cm^3$, and $D = 10\ dynes/cm^3$
```python
T = .8
a = 0.65
c_n = np.array([7.58,5.41,1.52,.52,.83,.69,.26,.54,.27,.1])
phi_n = np.array([-174,89,-22,-34,-127,135,152,44,-72,11])*np.pi/180
omega = 2*np.pi/T #1.25 hertz
omegas = np.array([np.sqrt((n*rho*omega)/mu)*a for n in range(1,len(c_n)+1)])
lambdas = ((1j - 1)/np.sqrt(2))*omegas
waves = (10*c_n,phi_n,omegas,lambdas)
dp_dz = 50
flow(a,omega,mu,rho,waves,dp_dz,title='')
```
 **Figure 4:** Pulsatile flow with a driving pressure gradient based off of a typical heartbeat.  In this simulation the radius is 0.65 cm, and the steady component of the pressure gradient is weighted at $50 \ dynes/cm^3$, while the oscillatory is weighted at $10 \ dynes/cm^3$.

```python
a = .3 #.65 cm
omegas = np.array([np.sqrt((n*rho*omega)/mu)*a for n in range(1,len(c_n)+1)])
lambdas = ((1j - 1)/np.sqrt(2))*omegas
waves = (30*c_n,phi_n,omegas,lambdas)
dp_dz = 20
flow(a,omega,mu,rho,waves,dp_dz)
```
 **Figure 5:**: Pulsatile flow with a driving pressure gradient based off of a typical heartbeat.  In this simulation the radius is 0.3 cm, and the steady component of the pressure gradient is weighted at $20 \ dynes/cm^3$, while the oscillatory is weighted at $30 \ dynes/cm^3$.

 #### Discussion

 ##### Simulation Results

 ###### Steady:
 From the model, we can see that $v_{max} \propto R^2 \frac{d p}{d z}$, which explains why there was such a larger Reynolds number for the flow with the larger radius.  Similarly, $Q \propto R^4 \frac{d p}{d z}$ and $\tau_{rz} \propto R \frac{d p}{d z}$.  Since $Re \propto v_{max} R$, this tells us that $Re \propto R^3 \frac{d p}{d z}$, meaning that the Reynolds number is much more sensitive to changes in radius than changes in pressure gradient for steady flow.  Similarly for the max velocity, and flow rate, while shear stress is equally sensitive to changes in the radius and pressure gradient.

 ###### Oscillatory
 For oscillatory flow, the magnitude of the flow is proportional to $\frac{R^2}{\Omega_n^2} \frac{d p}{d z}$, but since $\Omega_n = R \sqrt{\frac{\rho \omega}{\mu}}$, this means that $v_{max} \propto \frac{d p}{d z}$, similarly $Q \propto \frac{R^4}{\Omega_n^4} \frac{d p}{d z} \propto R^2 \frac{d p}{d z}$, and $\tau_{rz} \propto \frac{R}{\Lambda_n} \frac{d p}{d z} \propto \frac{d p}{d z}$.  For oscillatory flow, max velocity scales with the magnitude of the pressure gradient, volumetric flow rate scales with radius squared and pressure gradient, and shear stress scales with only the pressure gradient.

 ###### Pulsatile:
 Since the steady and oscillatory components of pulsatile flow scale with radius and pressure differently,  the oscillatory portion of the pressure gradient is a larger factor in oscillatory flow profiles and shear stress than vessel radius, whereas for the steady component of flow, the radius is more important than the static pressure gradient for static flow profile and shear stress. Particularly important for the steady component is the flow rate which is proportional to $R^4$.  This means that small changes to radius, such as the clogging due to plaque deposits would have a very large affect on flow rate to downstream tissue, as well as the pressure required to drive flow through this vessel.

 This difference can be quantified by the Reynolds number ($\frac{ \rho v_{max} D }{\mu}$) and the Womersley number ($R \sqrt{\frac{\rho \omega}{\mu}}$).  Reynolds number reflects the relative important of inertial to viscous forces in steady flow, and this quantity scales with $R^3$.  Womersley number similarly reflects the relative important of inertial to viscous forces in oscillatory flow, but this quantity only scales with $R^1$.  The different scalings of these numbers reflects the very different changes in flow profiles from larger radius with smaller pressure to smaller radius with larger pressure for steady and oscillatory flows.

 ##### Limitations

 While these simulations give a good idea of blood flow in arteries driven by heart, including the relative important of vessel radius and pressure gradients in the steady and oscillatory components of flow, there are some serious limitations to this approach.  First, as was mentioned in the introduction, a these models assume newtonian flow, and blood is non-newtonian, best described by the casson model. Due to this, areas of flow with too low of shear stress wouldn't deform.  This would lead to even more blunted profiles.
 Additionally, as blood vessels get smaller and smaller into the capillaries, the viscosity of blood gets smaller due to blood being shear-thinning and the shear rate increasing in the capillaries.  As the blood flows into the capillaries and $\mu$ decreases, the Womersley number $\Omega$ will increase since $\Omega \propto \frac{1}{\sqrt{\mu}}$.  This would further affect the difference in scaling for the steady and oscillatory portions of flow.

 #### Conclusion

 This approach give insight into the physics of heart-driven pulsatile flow in the body, however it leaves out some significant physiological aspects of blood flow, namely the non-Newtonian, shear-thinning properties of blood.  While this approach leaves out some physiological aspects, it has the advantage of giving an analytical solution such that that intuitions into physiological blood flow can be understood.  Not only does this approach allow for visualizing blood flow, but it also demonstrates how important quantities like the Womersley number and Reynolds number arise.  It also gives some idea of how properties of blood flow such as flow rate, and shear stress are impacted by variables such as artery diameter and driving pressure gradient.

 #### References
 1. A. R. Snider, M. A. Enderlein, D. F. Teitel, and R. P. Juster, “Two-dimensional echocardiographic determination of aortic and pulmonary artery sizes from infancy to adulthood in normal subjects,” Am. J. Cardiol., vol. 53, no. 1, pp. 218–224, 1984.
 2.  A. Brüel and H. Oxlund, “Changes in biomechanical properties, composition of collagen and elastin, and advanced glycation endproducts of the rat aorta in relation to age,” Atherosclerosis, vol. 127, no. 2, pp. 155–165, 1996.
 3.  D. N. Ku, “Blood flow in arteries,” Annu. Rev. Fluid Mech., vol. 29, pp. 399–434, 1974.
 4. J. Boyd, J. M. Buick, and S. Green, “Analysis of the Casson and Carreau-Yasuda non-Newtonian blood models in steady and oscillatory flows using the lattice Boltzmann method,” Phys. Fluids, vol. 19, no. 9, 2007.
 ## Appendix I: Code
 ```python
#!/usr/bin/env python
import numpy as np
import re
from scipy.special import jv
import matplotlib.animation as animation
import matplotlib.pyplot as plt
from IPython.display import display_html
def womersley(rho,omega,mu,a): # Oscillatory portion
    #a: radius
    #mu: viscosity
    #omega: frequency
    #rho: density
    return a*np.sqrt((rho*omega)/mu)
def reynolds(rho, u_max, D, mu): # steady portion
    #rho: density
    #u_max: max velocity
    #D: diameter
    #mu: viscosity
    return (rho*u_max*D)/mu

def pressure(dp_dz,omega,waves,t,mode='pulsatile'):
    """Computes the pressure wave for a given set of parameters
        Parameters
        ----------
        dp_dz   : float
                Steady state pressure grad

        omega   : float
            Oscillation frequency in radians/s

        waves   : tuple of lists: (C_ns,Phi_ns,omegas,lambdas)
            4-Tuple of lists of the parameters C_n, Phi_n, omega, and lambda for each
                harmonic of the wave

        t       : array-like
            ndarray of x-values or times with which to compute the wave

        Returns
        -------
        press : ndarray
            Array with the same dimensions as t that is the value of pressure computed
                for those values of t.
    """
    c_ns,phi_ns,omegas,lambdas = waves
    press_ind = np.array([c_n*np.exp(1j*(omega*(n+1)*t + phi_n))
            for n,(c_n,phi_n) in enumerate(zip(c_ns,phi_ns))])
    press = np.sum(press_ind,axis=0)
    if mode == 'steady':
        return np.zeros_like(press) + dp_dz
    elif mode == 'oscillatory':
        return np.sum(press_ind,axis=0).real
    else:
        return press.real + dp_dz
def Q(a,omega,mu,waves,dp_dz,t,mode='pulsatile'):
    """Calculates the volumetric flow rate for a given pressure function.
        Parameters
        ----------
        a       : float
            Radius of the inside of the tube

        omega   : float
            Oscillation frequency in radians/s

        mu      : float
            Newtonian viscosity of fluid

        waves   : tuple of lists: (C_ns,Phi_ns,omegas,lambdas)
            4-Tuple of lists of the parameters C_n, Phi_n, omega, and lambda for each
                harmonic of the wave

        dp_dz   : float
            Steady state pressure grad

        t       : array-like
            ndarray of x-values or times with which to compute the wave

        Returns
        -------
        q_total : ndarray
            Array with the same dimensions as t that is the value of Q computed
                for those values of t.
    """
    q_steady = (dp_dz*np.pi*a**4)/(8*mu)
    c_ns,phi_ns,omegas,lambdas = waves
    omegas = np.array([np.sqrt((n*rho*omega)/mu)*a for n in range(1,len(c_ns)+1)])
    lambdas = ((1j - 1)/np.sqrt(2))*omegas
    q_unsteady = np.array([((1j*np.pi*c_n*a**4)/(mu*om**2))*\
            (1 - (2*jv(1,lam))/(lam*jv(1,lam)))*\
            np.exp(1j*((n + 1)*omega*t + phi_n))\
            for n,(c_n,phi_n,om,lam) in enumerate(zip(c_ns,phi_ns,omegas,lambdas))])
    q_total = np.sum(q_unsteady,axis=0) + q_steady
    if mode == 'steady':
        return np.zeros_like(q_total) + q_steady
    elif mode == 'oscillatory':
        return np.sum(q_unsteady,axis=0).real
    else:
        return q_total.real
def tau(a,waves,dp_dz,t,mode='pulsatile'):
    """ Calculates the shear stress at the wall (a) for a given pressure function.
        Parameters
        ----------
        a       : float
            Radius of the inside of the tube

        waves   : tuple of lists: (C_ns,Phi_ns,omegas,lambdas)
            4-Tuple of lists of the parameters C_n, Phi_n, omega, and lambda for each
                harmonic of the wave

        dp_dz   : float
                Steady state pressure grad

        t       : array-like
            ndarray of x-values or times with which to compute the wave

        Returns
        -------
        tau_tot : ndarray
            Array with the same dimensions as t that is the value of tau computed
                for those values of t.
    """
    tau_steady = dp_dz*a/2
    c_ns,phi_ns,omegas,lambdas = waves
    tau_unsteady = np.array([(-c_n*a/lam)*(jv(1,lam)/jv(0,lam))*\
            np.exp(1j*((n + 1)*omega*t + phi_n))\
            for n,[c_n,phi_n,lam] in enumerate(zip(c_ns,phi_ns,lambdas))])
    tau_tot = np.sum(tau_unsteady,axis=0) + tau_steady
    if mode == 'steady':
        return np.zeros_like(tau_tot) + tau_steady
    elif mode == 'oscillatory':
        return np.sum(tau_unsteady,axis=0)
    else:
        return tau_tot.real

def flow_steady(a,mu,rho,dp_dz,ax,title):
    """TODO: Docstring for flow_steady.

    Parameters
    ----------
        a       : float
            Radius of the inside of the tube

        mu      : float
            Newtonian viscosity of fluid

        rho     : float
            Constant density of fluid

        dp_dz   : float
            Steady state pressure grad

        ax      : list of matplotlib axes
            velocity, flow rate, and wall shear stress axes to plot onto

        title   : string
            Name of the figure to make

        Returns
        -------
        maximum of the steady velocity.
    """
    plt.style.use('ggplot')
    ax_v,ax_q,ax_t = ax

    #Plot "tube" on velocity profile graph
    ax_v.plot([-400,400],[1,1])
    ax_v.plot([-400,400],[-1,-1])
    waves = [[1],[1],[1],[1]]
    times = np.linspace(0,5*T,1000)
    r_a = np.linspace(-1,1)
    v_steady = dp_dz*a**2/(4*mu)*(1 - r_a**2)
    ax_v.set_xlim([-10,np.max(v_steady)*1.1])
    flow_q = Q(a,omega,mu,waves,dp_dz,times,mode='steady')
    flow_tau = tau(a,waves,dp_dz,times,mode='steady')
    ax_v.plot(v_steady,r_a)
    ax_v.set_xlabel(r'$v_z$ cm/s')
    ax_v.set_ylabel(r'Normalized Radius $\frac{r}{R}$')
    ax_v.set_title(title)
    ax_q.plot(times,flow_q)
    ax_q.set_xlabel('time (s)')
    ax_q.set_ylabel(r'Volumetric flow rate ($cm^3$/s)')
    ax_t.plot(times,flow_tau)
    ax_t.set_xlabel('time (s)')
    ax_t.set_ylabel(r'Shear stress (dyne/$cm^2$)')
    return np.max(v_steady)

def flow(a,omega,mu,rho,waves,dp_dz,mode='pulsatile',title=''):
    """Creates an animation of the velocity profile, pressure wave, flow rate,
        and wall shear stress for pulsatile flow

        Parameters
        ----------
        a       : float
            Radius of the inside of the tube

        omega   : float
            Oscillation frequency in radians/s

        mu      : float
            Newtonian viscosity of fluid

        rho     : float
            Constant density of fluid

        waves   : tuple of lists: (C_ns,Phi_ns,omegas,lambdas)
            4-Tuple of lists of the parameters C_n, Phi_n, omega, and lambda for each
                harmonic of the wave

        dp_dz   : float
            Steady state pressure grad

        Returns
        -------
        n/a.  Function prints out the raw video into an html5 video tag using the
        animation.FuncAnimation.to_html5_video() function.
    """
    plt.style.use('ggplot')
    fig = plt.figure(figsize=(15,15))
    fig.suptitle(title,fontsize=18)
    ax_v = fig.add_subplot(411)
    ax_p = fig.add_subplot(412)
    ax_q = fig.add_subplot(413,sharex=ax_p)
    ax_t = fig.add_subplot(414,sharex=ax_p)

    #Plot "tube" on velocity profile graph
    ax_v.plot([-250,250],[1,1])
    ax_v.plot([-250,250],[-1,-1])
    ax_v.set_xlim([-50,200])

    #TODO: set x_limit for all other axes
    # 2 cycles
    times = np.linspace(0,5*T,1000)

    # Set Omega, Lambda, Zeta, C_n values, Phi_n values, and the constant coefficient out front
    r_a = np.linspace(-1,1)
    c_ns,phi_ns,omegas,lambdas = waves

    # Steady state flow rate
    v_steady = dp_dz*a**2/(4*mu)*(1 - r_a**2)

    # Pressure
    if mode == 'pulsatile':
        flow_pressure = pressure(dp_dz,omega,waves,times)
        flow_Q = Q(a,omega,mu,waves,dp_dz,times)
        flow_tau = tau(a,waves,dp_dz,times)
    else:
        flow_pressure = pressure(dp_dz,omega,waves,times,mode='oscillatory')
        flow_Q = Q(a,omega,mu,waves,dp_dz,times,mode='oscillatory')
        flow_tau = tau(a,waves,dp_dz,times,mode='oscillatory')
    ax_p.plot(times,flow_pressure)
    ax_q.plot(times,flow_Q)
    ax_t.plot(times,flow_tau)

    # X and Y Labels
    ax_v.set_xlabel(r'$v_z(r/a)$')
    ax_t.set_xlabel('time (s)')

    ax_v.set_ylabel(r'Normalized Radius ($r/a$)')
    ax_p.set_ylabel(r'Pressure ($dyne/cm^2$)')
    ax_q.set_ylabel(r'Flow Rate ($cm^3/s$)')
    ax_t.set_ylabel(r'Wall shear stress ($dyne/cm^2$)')

    #Limits
    ax_p.set_xlim([0,times[-1]])
    p_range = (np.max(flow_pressure)-np.min(flow_pressure))/2
    q_range = (np.max(flow_Q)-np.min(flow_Q))/2
    t_range = (np.max(flow_tau)-np.min(flow_tau))/2
    ax_p.set_ylim([np.min(flow_pressure)-p_range,np.max(flow_pressure)+p_range])
    ax_q.set_ylim([np.min(flow_Q)-q_range,np.max(flow_Q)+q_range])
    ax_t.set_ylim([np.min(flow_tau)-t_range,np.max(flow_tau)+t_range])

    #Base lines:
    p_follow, = ax_p.plot([0,0],[np.min(flow_pressure)-p_range*1.1,np.max(flow_pressure)+p_range*1.1])
    #ax_p.plot([-10,20],[50,50])
    q_follow, = ax_q.plot([0,0],[np.min(flow_Q)-q_range*1.1,np.max(flow_Q)+q_range*1.1])
    t_follow, = ax_t.plot([0,0],[np.min(flow_tau)-t_range*1.1,np.max(flow_tau)+t_range*1.1])
    u_an = np.array([((1j*c_n*a**2)/(mu*om**2))*(1 - (jv(0,abs(r_a)*lam)/jv(0,lam)))* \
            np.exp(1j*((n + 1)*omega*0 + phi_n)) \
            for n,[c_n,phi_n,om,lam] in enumerate(zip(c_ns,phi_ns,omegas,lambdas))])
    u_a_tot = np.sum(u_an,axis=0) #TODO + u_steady
    line, = ax_v.plot(u_a_tot.real,r_a)
    num_frames=100

    def animate(t):
        v_unsteady = np.array([((1j*c_n*a**2)/(mu*om**2))*(1 - (jv(0,abs(r_a)*lam)/jv(0,lam)))* \
                np.exp(1j*((n + 1)*omega*t + phi_n)) \
                for n,[c_n,phi_n,om,lam] in enumerate(zip(c_ns,phi_ns,omegas,lambdas))])
        if mode == 'pulsatile':
            v_tot = np.sum(v_unsteady,axis=0) + v_steady
        else:
            v_tot = np.sum(v_unsteady,axis=0)
        p_follow.set_xdata([t, t])
        q_follow.set_xdata([t, t])
        t_follow.set_xdata([t, t])

        line.set_xdata(v_tot.real)  # update the data.
        return line,
    def frames_gen():
        # 100 frames from 0 to 5 periods.
        T = 1/(omega/(2*np.pi))
        for frame in np.linspace(0,5*T,num_frames):
            yield frame
    # 100 frames that go to 5*T seconds.  (5*T)/100 is interval in seconds, times by 1000 to get interval in seconds
    real_interval = ((5*T)/num_frames)*1000
    ani = animation.FuncAnimation(
            fig, animate, interval=real_interval, save_count=num_frames, frames=frames_gen,repeat_delay=0)
    vid = ani.to_html5_video()
    # Change width to 100% and remove height
    vid = re.sub(r'width="\d+"',r'width="100%"',vid)
    vid = re.sub(r'height="\d+"',r'',vid)
    #display video
    display_html(vid,raw=True)

# Steady Flow
fig,ax = plt.subplots(3,2,figsize=(15,15))
fig.suptitle('Steady Flow', fontsize=20)
rho = 1.06 #1060 kg/m^2 == 1.06g/cm^3
mu = .04
a = .65 #.65 cm
dp_dz = 46
umax = flow_steady(a,mu,rho,dp_dz,ax[:,0],r'$-\frac{d p}{d z} = 46 \ dynes/cm^3$, $R = 0.65 \ cm$')

a = .30 #cm
dp_dz = 100
umax2 = flow_steady(a,mu,rho,dp_dz,ax[:,1],r'$-\frac{d p}{d z} = 100 \ dynes/cm^3$, $R = 0.3 \ cm$')

#Oscillatory Flow
T = .8
omega = 2*np.pi/T #1.25 hertz
a = .65
c_n_o_1 = [46]
phi_n_o_1 = [0]
omegas_o_1 = np.array([np.sqrt((n*rho*omega)/mu)*a for n in range(1,len(c_n_o_1)+1)])
lambdas_o_1 = ((1j - 1)/np.sqrt(2))*omegas_o_1
waves = (c_n_o_1,phi_n_o_1,omegas_o_1,lambdas_o_1)
flow(a,omega,mu,rho,waves,dp_dz,mode='oscillatory',title=r'Oscillatory flow for $- \frac{d P}{d z} = 46 \cos( \omega t) \ dynes/cm^3$ and $R = 0.65 \ cm$')

a = .3
c_n_o_2 =  [100]
phi_n_o_2 = [0]
omegas_o_2 = np.array([np.sqrt((n*rho*omega)/mu)*a for n in range(1,len(c_n_o_2)+1)])
lambdas_o_2 = ((1j - 1)/np.sqrt(2))*omegas_o_2
waves = (c_n_o_2,phi_n_o_2,omegas_o_2,lambdas_o_2)
flow(a,omega,mu,rho,waves,dp_dz,mode='oscillatory',title=r'Oscillatory flow for $- \frac{d P}{d z} = 100 \cos( \omega t) \ dynes/cm^3$ and $R = \ 0.3 cm$')

# Pulsatile Flow
T = .8
a = 0.65
c_n = np.array([7.58,5.41,1.52,.52,.83,.69,.26,.54,.27,.1])
phi_n = np.array([-174,89,-22,-34,-127,135,152,44,-72,11])*np.pi/180
omega = 2*np.pi/T #1.25 hertz
omegas = np.array([np.sqrt((n*rho*omega)/mu)*a for n in range(1,len(c_n)+1)])
lambdas = ((1j - 1)/np.sqrt(2))*omegas
waves = (10*c_n,phi_n,omegas,lambdas)
dp_dz = 50
flow(a,omega,mu,rho,waves,dp_dz,title='')

a = .3 #.65 cm
omegas = np.array([np.sqrt((n*rho*omega)/mu)*a for n in range(1,len(c_n)+1)])
lambdas = ((1j - 1)/np.sqrt(2))*omegas
waves = (30*c_n,phi_n,omegas,lambdas)
dp_dz = 20
flow(a,omega,mu,rho,waves,dp_dz)
```
 ## Appendix II

Velocity profiles, Flow rate, and Wall shear stress can be calculated
for pulsatile flow by separating the steady and oscillatory profiles:

###Steady

#### Velocity

For steady flow in a tube we can make the following assumptions:

1. $v_z = f(r)$
2. $v_r = v_{\theta} = 0$
3. Constant viscosity (newtonian), and density
4. $p = f(z)$
5. $g_z = 0$

Under these assumptions, the $z$ component of the cylindrical
Navier-Stokes equations can be reduced and solved with the following
boundary conditions:

1.  $\displaystyle\left.\frac{d v_z}{d r}\right|_{r=0} \ne \infty$
2.  $v_z(r = a) = 0$
$$\begin{aligned}
    0 &= -     \frac{d p}{dz} + \mu \left( \frac{1}{r}     \frac{d }{d r} \left(r     \frac{d v_z}{d r}\right)\right)\\
    \frac{r}{\mu} \frac{d p}{d z} &= \frac{d}{d r} \left( r \frac{d v_z}{d r} \right)\\
    \frac{d v_z}{d r} &=\frac{r}{2 \mu} \frac{d p}{d z} + \frac{c}{r} \rightarrow \textrm{BC 1: $c = 0$} \\
    v_z &= \frac{r^2}{4 \mu}     \frac{d p}{dz} + c, \ \textrm{BC 2: $v_z(r=a) = 0$}\\
    c  &= -\frac{a^2}{4 \mu}     \frac{d p}{dz} \\
  v_z &= \frac{a^2}{4 \mu}     \left( -\frac{d p}{dz}\right) \left( 1 - \left(\frac{r}{a}\right)^2\right)
\end{aligned}$$

#### Flow Rate

Given the above velocity profile, we can calculate the flow rate $Q$
with: 
$$\begin{aligned}
    Q &= \int_0^a v_z(r) 2 \pi r dr\\
     &= \int_0^a \frac{a^2}{4 \mu} \left( - \frac{d p}{d z} \right) \left(1 - \left(\frac{r}{a}\right)^2 \right) 2 \pi r dr\\
     &= \frac{2 \pi a^2}{4 \mu}\left( - \frac{d p}{d z} \right)\int_0^a r - \frac{r^3}{a^2} dr\\
     &= \frac{2 \pi a^2}{4 \mu}\left( - \frac{d p}{d z} \right)\left[ \frac{r^2}{2} - \frac{r^4}{4 a^2} \right]_0^a\\
     &=\frac{2 \pi a^2}{4 \mu}\left( - \frac{d p}{d z} \right)\left( \frac{a^2}{2} - \frac{a^4}{4 a^2} \right)\\
     &=\frac{2 \pi a^4}{8 \mu}\left( - \frac{d p}{d z} \right)\left(1 - 1/2 \right) \\
     &=\frac{ \pi a^4}{8 \mu}\left( - \frac{d p}{d z} \right)\end{aligned}$$

#### Shear Stress

We can similarly calculate shear stress from the velocity profile:
$$\begin{aligned}
    \tau_{rz} &=2 \mu D_{rz} = 2 \mu * \frac{1}{2}\left(    \frac{\partial v_z}{\partial r}   +  \frac{\partial v_r}{dz}\right)\\
            &= \mu \left(\frac{\partial v_z(r,t)}{\partial r}\right)\\
              &= \frac{a^2}{4}\left( - \frac{d p}{d z} \right) \frac{d}{d r} \left(1 - \frac{r^2}{a^2}\right) \\
              &= \frac{a^2}{4}     \left( - \frac{d p}{d z} \right) \left( - \frac{2 r}{a^2}\right)\\
    \left.\tau_{rz}\right|_{r = a} &= \frac{a^2}{4}     \left( - \frac{d p}{d z} \right) \left( - \frac{2 a}{a^2}\right)\\
                                   &= - \frac{a}{2}     \left( - \frac{d p}{d z} \right)\end{aligned}$$

### Oscillatory

#### Velocity

For unsteady flow in a tube, we can make the following assumptions:

1.$v_z = f(r,t)$
2.$v_r = v_{\theta} = 0$
3.Constant viscosity (newtonian), and density
4.$p = f(z,t)$
5.$g_z = 0$

These assumptions give us the following simplified $z$ component of the
cylindrical Navier-Stokes equations:
$$\rho \frac{\partial v_z}{\partial t}  = -     \frac{\partial p}{\partial z} + \mu \left[    \frac{1}{r}\frac{\partial}{\partial r}\left(r     \frac{\partial v_z}{\partial r}\right)\right]$$
If we assume the pressure gradient is a sum of sine or cosine waves and
represent this as a sum of exponentials:
$\frac{\partial p(z,t)}{\partial z} = p_s + p_o \sum_{n=1}^N (\cos n \omega t + i \sin n \omega t) = p_s + p_o \sum_{n=1}^N e^{i n \omega t}$,
where n is the harmonic of the wave. Then we can solve the governing
equation separately for each harmonic and sum the terms:
$$\begin{aligned}
    \rho \frac{\partial v_z}{\partial t}  &= -     p_o e^{i n \omega t} + \mu \left[    \frac{1}{r}\frac{\partial}{\partial r}\left(r     \frac{\partial v_z}{\partial r}\right)\right]\end{aligned}$$
Postulating that the velocity profile $v_z(r,t)$ will follow a similar
profile as the pressure gradient allows us to separate the $r$ and $t$
components: $v_z(r,t) = V(r) e^{i n \omega t}$. Using this separation of
variables we have that:

-   $$\frac{\partial v_z}{\partial t} = i n \omega V(r) e^{i n \omega t}$$
-   $$\frac{\partial v_z}{\partial r} = \frac{d V(r)}{d r} e^{i n \omega t}$$
-   $$\frac{d}{d r} r \frac{d V(r)}{r} = \frac{d V(r)}{d r} + r \frac{d^2 V(r)}{d r}$$

$$\begin{aligned}
    \rho i n \omega V(r) e^{i n \omega t}  &= -     p_o e^{i n \omega t} + \mu   \left[  \frac{d V(r)}{d r} + r \frac{d^2 V(r)}{d r}   \right] e^{i n \omega t} \\
    \frac{p_0}{\mu} &=\frac{d^2 V(r)}{d r^2} + \frac{1}{r} \frac{d V(r)}{d r} - \frac{\rho n i \omega V(r)}{\mu} \end{aligned}$$
For $\Omega_n = a \sqrt{\frac{\rho n \omega}{\mu}}$, this becomes:
$$\frac{d^2 V(r)}{d r^2} + \frac{1}{r} \frac{d V(r)}{d r} - \frac{i \Omega_n^2 V(r)}{a^2} = \frac{p_0}{\mu}$$
If we do a change of variables $\zeta = \Lambda \frac{r}{a}$, then
$\frac{d}{d r} = \frac{d}{d \zeta} \frac{d \zeta}{d r} = \frac{d}{d \zeta}\frac{\Lambda}{a}$,
and $\frac{d^2}{d r^2} = \frac{d^2}{d \zeta^2} \frac{\Lambda^2}{a^2}$.
If $\Lambda = \left(\frac{i - 1}{\sqrt{2}}\right) \Omega$, then we get:
$$\begin{aligned}
    \frac{\Lambda^2}{a^2} \frac{d^2 V(\zeta)}{d \zeta^2} + \frac{\Lambda}{a \zeta}\frac{\Lambda}{a} \frac{d V(\zeta)}{d \zeta} - \frac{i \Omega_n^2 V(\zeta)}{a^2} &= \frac{p_0}{\mu}\\
    \frac{-i \Omega_n^2}{a^2} \frac{d^2 V(\zeta)}{d \zeta^2} + \frac{-i \Omega^2}{a^2}\frac{1}{ \zeta} \frac{d V(\zeta)}{d \zeta} - \frac{i \Omega^2 V(\zeta)}{a^2} &= \frac{p_0}{\mu}\end{aligned}$$
If we divide by $\frac{-i \Omega_n^2}{a^2}$, then separate the solution
into homogenous and particular solutions: 
$$\begin{aligned}
    V &= V_h + V_p\\
    0 &= \frac{d^2 V(\zeta)}{d \zeta^2} + \frac{1}{\zeta}\frac{d V(\zeta)}{d \zeta} +  V(\zeta) \ \textrm{ ($V_h$)}\\
    0 &= \zeta^2 \frac{d^2 V(\zeta)}{d \zeta^2} + \zeta\frac{d V(\zeta)}{d \zeta} +  (\zeta^2 - \alpha^2) V(\zeta)  \textrm{, Where $\alpha = 0$}\\\end{aligned}$$
This last equation is known as Bessel's differential equation, and has a
solution of the form: $V_h(\zeta) = A_n J_0(\zeta) + B_n Y_0(\zeta)$,
where $J_0$ is the 0th order Bessel function of the 1st kind, and $Y_0$
is the 0th order Bessel function of the second kind. However,
$Y_0(0) = -\infty$, so for the solution to be finite at the center,
$B_n = 0$. 
$$\begin{aligned}
    V(\zeta) &= V_h(\zeta) + V_p(\zeta)\\
         &= A_n J_0(\zeta) + \frac{i p_o a^2}{\mu \Omega^2} \end{aligned}$$
Our next boundary condition is that at the wall, the velocity must be 0.
At the wall, $\zeta = \Lambda_n \frac{a}{a}$ $V(\Lambda_n) = 0$. If we
plug in this boundary condition and then substitute $V(\zeta)$ back into
$v_z = V(\zeta) e^{i n \omega t}$, we get: 
$$\begin{aligned}
    0 &= A_n J_0(\Lambda_n) + \frac{i p_o a^2}{\mu \Omega_n^2} \\
    A_n &= -\frac{\frac{i p_o a^2}{\mu \Omega_n^2}}{J_0(\Lambda_n)} \\
    V(\zeta) &= \frac{i p_o a^2}{\mu \Omega_n^2}\left(1 - \frac{J_0(\zeta)}{J_0(\Lambda_n)} \right)\\
    v_z^n(\zeta,t) &= \frac{i p_o a^2}{\mu \Omega_n^2}\left(1 - \frac{J_0(\zeta)}{J_0(\Lambda_n)} \right) e^{i n \omega t}\end{aligned}$$

#### Flow Rate

$$\begin{aligned}
    Q_n(t) &= \int_0^a 2 \pi r v_{z}^n(r,t) dr\\
           &= \frac{2 \pi p_o a^2}{\mu \Omega_n^2} e^{i n \omega t} \int_0^{a} r \left(1 - \frac{J_0(\zeta)}{J_o(\Lambda)} \right) dr\end{aligned}$$
We can substitute $r = \frac{a}{\Lambda} \zeta$ and
$dr = \frac{a}{\Lambda} d \zeta$. We can solve this integral by using
the identity: $\int_0^a x J_0(x) dx = a J_1(a)$ 
$$\begin{aligned}
           &= \frac{2 \pi p_o a^2}{\mu \Omega_n^2} e^{i n \omega t} \frac{a^2}{\Lambda_n^2 J_0(\Lambda_n)} \int_0^{\Lambda_n} \zeta \left(J_0(\Lambda_n) - J_0(\zeta) \right) d \zeta\\
           &= \frac{2 \pi p_o a^2}{\mu \Omega_n^2} e^{i n \omega t} \frac{a^2}{\Lambda_n^2 J_0(\Lambda_n)} \left(\int_0^{\Lambda_n} \zeta J_0(\Lambda_n) - \int_0^{\Lambda_n}\zeta J_0(\zeta) d \zeta \right)\\
           &= \frac{2 \pi p_o a^2}{\mu \Omega_n^2} e^{i n \omega t} \frac{a^2}{\Lambda_n^2 J_0(\Lambda_n)} \left(\frac{\Lambda_n^2}{2} J_0(\Lambda_n) - \Lambda_n J_1(\Lambda_n) \right)\\
           &= \frac{2 \pi p_o a^2}{\mu \Omega_n^2} e^{i n \omega t} \frac{a^2}{2} \left(1 - \frac{2 J_1(\Lambda_n)}{\Lambda_n J_0(\Lambda_n)}\right)\\
           &= \frac{\pi p_o a^4}{\mu \Omega_n^2} \left(1 - \frac{2 J_1(\Lambda_n)}{\Lambda_n J_0(\Lambda_n)}\right)e^{i n \omega t} \end{aligned}$$

#### Shear Stress

We can use the constitutive relation
$\tau_{rz} = 2 \mu \frac{1}{2}\left(    \frac{\partial v_z}{\partial r}+     \frac{\partial v_r}{\partial z}\right)$,
and the identity $\frac{d J_0(x)}{d x} = -J_1(x)$: 
$$\begin{aligned}
    \tau_n(t) &= -\mu \left(    \frac{\partial v_n(r,t)}{\partial r}\right)_{r=a} e^{i n \omega t}\\
              &= -\frac{i p_o a^2}{\Omega_n^2}\left[\frac{d}{d r}\left(1 - \frac{J_0(\zeta)}{J_0(\Lambda_n)} \right)   \right]_{r=a} e^{i n \omega t}\\
              &= -\frac{i p_o a^2}{\Omega_n^2}\frac{\Lambda_n}{a}\left[\frac{d}{d \zeta}\left(1 - \frac{J_0(\zeta)}{J_0(\Lambda_n)} \right)   \right]_{\zeta=\Lambda_n} e^{i n \omega t}\\
              &= -\frac{i p_o a^2}{\Omega_n^2}\frac{\Lambda_n}{a}\left[\left(\frac{J_1(\zeta)}{J_0(\Lambda_n)} \right)   \right]_{\zeta=\Lambda_n} e^{i n \omega t}\\
              &= -\frac{i p_o a^2}{\Omega_n^2}\frac{\Lambda_n}{a}\left(\frac{J_1(\Lambda_n)}{J_0(\Lambda_n)} \right) e^{i n \omega t}\\
              &= -\frac{p_o a}{\Lambda_n}\left(\frac{J_1(\Lambda_n)}{J_0(\Lambda_n)} \right) e^{i n \omega t}\\\end{aligned}$$
The last simplification was made since 
$$\frac{i \Lambda}{\Omega^2} = \frac{1}{\Lambda}$$

### Pulsatile

#### Velocity

Flow is driven by the following combined pressure gradient:
$$\frac{d p}{d z} = -p_s - p_o \sum_{n=1}^N C_n e^{i (n \omega t + \phi_n)} \textrm{, Where $\omega = \frac{2 \pi}{T}$}$$
Combining our steady and oscillatory velocity profiles, we get:
$$v_{z,o}(r,t) = \frac{p_s a^2}{4 \mu} \left(1 - \left(\frac{r}{a}\right)^2\right) + p_o \displaystyle \sum_{n = 1}^{N} \frac{i C_n a^2}{\mu \Omega_n^2} \left(1 - \frac{J_0 (\zeta)}{J_0 (\Lambda_n)}\right) e^{i (\omega n t - \phi_n)}$$

#### Flow Rate

Similarly, combining the steady and oscillatory portions of flow rate,
we get:
$$Q(t) = \frac{\pi a^4 p_s}{8 \mu} +\displaystyle \sum_{n=1}^N\frac{\pi p_n a^4}{\mu \Omega_n^2} \left(1 - \frac{2 J_1(\Lambda_n)}{\Lambda_n J_0(\Lambda_n)}\right)e^{i n \omega t}$$

#### Wall shear stress

And finally, for wall shear stress we can similarly combine our steady
and oscillatory profiles.
$$\tau(t) = -\frac{a p_s}{2} +  \sum_{n=1}^{N}-\frac{p_n a}{\Lambda_n}\left(\frac{J_1(\Lambda_n)}{J_0(\Lambda_n)} \right) e^{i n \omega t}\\
